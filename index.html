<!DOCTYPE html>
<html>
<head>
<title>Canvas by Cambridge Design Partnership</title>
<style type="text/css">
body {margin:0px; overflow: hidden}
</style>
<script src="http://code.jquery.com/jquery-latest.js"></script>
</head>
<body onresize="resize()">
<canvas id="myCanvas" width="500" height="500" style="border:0px">
Your browser does not support the canvas element.
</canvas>

<script type="text/javascript">

var dragok = false; 
var canvas;
var cxt;
var x = 0.5;
var y = 0.5;
var size = 0.5;
	
function init()
{
	canvas = document.getElementById("myCanvas");
	cxt=canvas.getContext("2d");
    resize();
	setInterval(render, 50);
}

function resize()
{
    canvas.width = window.innerWidth;
    canvas.height = window.innerHeight;
	
	render();
}

function convertx(x, size) {	return (x - (size/2)) * window.innerWidth ;}
function converty(y, size, aspectRatio) {	return (y * window.innerHeight - ((size/2)* aspectRatio) * window.innerWidth);}
function convertSize(size) {	return size * window.innerWidth;}

function drawImage(img, x, y, size, rotation)
{
	aspectRatio = img.height / img.width;
	cxt.rotate(rotation * Math.PI / 180);
	cxt.drawImage(img, convertx(x, size),converty(y, size, aspectRatio), convertSize(size), (convertSize(size) * aspectRatio));

	cxt.rotate(-rotation * Math.PI / 180);
}

function myDown(e){
	if (   e.pageX < convertx(x, size) + convertSize(size) + 15 + canvas.offsetLeft 
		&& e.pageX > convertx(x, size) - 15 + canvas.offsetLeft 
		&& e.pageY < converty(y, size, aspectRatio) + (convertSize(size) * aspectRatio) + 15 + canvas.offsetTop 
		&& e.pageY > converty(y, size, aspectRatio) -15 + canvas.offsetTop)	
	{
		dragok = true;
		canvas.onmousemove = myMove;
	}
}

function myMove(e){
	if (dragok)	{
		x = (e.pageX - canvas.offsetLeft) / window.innerWidth;
		y = (e.pageY - canvas.offsetTop) / window.innerHeight;
		
	}
}

function myUp(){
	console.log("myUp");
	dragok = false;
	canvas.onmousemove = null;
}

function render()
{
	var img=new Image();
	img.src="http://i.qkme.me/6qsi.jpg";
	img.onload = function(){  
	  cxt.clearRect(0, 0, canvas.width, canvas.height);
	  drawImage(img, 0.1, 0.1, 0.2, 10);
	  drawImage(img, x, y, size);
	};  
	
}

init();
canvas.onmousedown = myDown;
canvas.onmouseup = myUp;



</script>

</body>
</html>